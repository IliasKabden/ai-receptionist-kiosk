# üé≠ 3D Real-time Avatar ‚Äî Quick Start

## ‚ú® –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π 3D-–∞–≤–∞—Ç–∞—Ä** (zero backend latency)  
‚úÖ **Lip-sync –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** —á–µ—Ä–µ–∑ WebAudio –∞–Ω–∞–ª–∏–∑  
‚úÖ **–≠–º–æ—Ü–∏–∏** (happy, sad, thinking, surprised, neutral)  
‚úÖ **–ñ–µ—Å—Ç—ã** (wave, point) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Ç–µ–∫—Ç—è—Ç—Å—è –∏–∑ —Ç–µ–∫—Å—Ç–∞ LLM  
‚úÖ **Placeholder –∞–≤–∞—Ç–∞—Ä** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –±–µ–∑ –º–æ–¥–µ–ª–µ–π  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ VRM –º–æ–¥–µ–ª–µ–π** ‚Äî –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ 3D-–º–æ–¥–µ–ª–∏  

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É –∫–∞–∫ –æ–±—ã—á–Ω–æ:
```powershell
.\run_kiosk_desktop.ps1
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ kiosk –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:5500/kiosk.html
```

### 3. –ê–≤–∞—Ç–∞—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
- –í—ã —Å—Ä–∞–∑—É —É–≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–π placeholder-–∞–≤–∞—Ç–∞—Ä (—Å—Ñ–µ—Ä–∞ + —Ç–µ–ª–æ)
- **Lip-sync —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –∞—É–¥–∏–æ
- **–≠–º–æ—Ü–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–µ–∫—Å—Ç—É –æ—Ç–≤–µ—Ç–∞:
  - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí "happy" (–∑–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç)
  - –ò–∑–≤–∏–Ω–µ–Ω–∏–µ ‚Üí "sad" (–≥–æ–ª—É–±–æ–π)
  - "–ü–æ–¥–æ–∂–¥–∏—Ç–µ" ‚Üí "thinking" (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)
  - –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π ‚Üí "neutral" (–±–µ–∂–µ–≤—ã–π)
- **–ñ–µ—Å—Ç—ã** —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö:
  - "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "–ü—Ä–∏–≤–µ—Ç" ‚Üí –º–∞—Ö–∞–µ—Ç "—Ä—É–∫–æ–π"
  - "–ù–∞–ø—Ä–∞–≤–æ", "–ù–∞–ª–µ–≤–æ" ‚Üí —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üé® –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –∞–≤–∞—Ç–∞—Ä

### –í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—É—é VRM-–º–æ–¥–µ–ª—å

–ù–∞–π–¥–∏—Ç–µ **–≥–æ—Ç–æ–≤—É—é VRM-–º–æ–¥–µ–ª—å** (–∫–∞–∑–∞—Ö—Å–∫–∞—è –¥–µ–≤—É—à–∫–∞):
- [VRoid Hub](https://hub.vroid.com/) ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ VRM-–º–æ–¥–µ–ª–∏
- [Booth.pm](https://booth.pm/) ‚Äî –ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å –∞–∑–∏–∞—Ç—Å–∫–∏–º–∏ —á–µ—Ä—Ç–∞–º–∏
- [Ready Player Me](https://readyplayer.me/) ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é –º–æ–¥–µ–ª—å –æ–Ω–ª–∞–π–Ω

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
1. –°–∫–∞—á–∞–π—Ç–µ `.vrm` —Ñ–∞–π–ª
2. –ü–æ–ª–æ–∂–∏—Ç–µ –≤ `frontend/static/models/avatar.vrm`
3. –í `avatar.js` –∏–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```javascript
// –í –º–µ—Ç–æ–¥–µ init() –∑–∞–º–µ–Ω–∏—Ç–µ:
await this.loadAvatar('models/avatar.vrm');
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ Ready Player Me API

Ready Player Me –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```javascript
// –í avatar.js –¥–æ–±–∞–≤—å—Ç–µ:
const RPM_URL = 'https://api.readyplayer.me/v1/avatars';

async function createAvatarFromPhoto(photoBlob) {
  const formData = new FormData();
  formData.append('photo', photoBlob);
  
  const response = await fetch(RPM_URL, {
    method: 'POST',
    body: formData
  });
  
  const data = await response.json();
  return data.url; // VRM model URL
}
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –£–ª—É—á—à–∏—Ç—å placeholder

–°–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π placeholder –≤ `avatar.js`:
```javascript
createPlaceholderAvatar() {
  // –î–æ–±–∞–≤—å—Ç–µ –≤–æ–ª–æ—Å—ã, –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–∏—Ü–æ, –æ–¥–µ–∂–¥—É
  // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ THREE.js –≥–µ–æ–º–µ—Ç—Ä–∏—é –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
}
```

---

## üé¨ –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ (–∂–µ—Å—Ç—ã)

### –î–ª—è VRM-–º–æ–¥–µ–ª–∏:
1. –°–∫–∞—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Å [Mixamo](https://www.mixamo.com/)
2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ VRM-compatible —Ñ–æ—Ä–º–∞—Ç
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ three.js AnimationMixer:

```javascript
// –í avatar.js
import { AnimationMixer, AnimationClip } from 'three';

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏:
const loader = new GLTFLoader();
const gltf = await loader.loadAsync('models/wave_animation.glb');
this.mixer = new AnimationMixer(this.vrm.scene);
const waveClip = AnimationClip.findByName(gltf.animations, 'wave');
const waveAction = this.mixer.clipAction(waveClip);

// –í playGesture():
if (gestureName === 'wave') {
  waveAction.reset().play();
}
```

---

## üéØ –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å —ç–º–æ—Ü–∏–∏

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: –ø—Ä–æ—Å—Ç—ã–µ keywords
- Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ç —ç–º–æ—Ü–∏—é –ø–æ —Ç–µ–∫—Å—Ç—É (—Å–º. `detect_emotion_from_text()` –≤ `stream_server.py`)

### –£–ª—É—á—à–µ–Ω–∏–µ: LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–æ—Ü–∏–π
–î–æ–±–∞–≤—å—Ç–µ –≤ system prompt –¥–ª—è LLM:
```python
SYSTEM_PROMPT_RU = """
–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ—Å–µ–ø—à–Ω. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —É–∫–∞–∂–∏ —ç–º–æ—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
[emotion: happy/sad/thinking/surprised/neutral]
[gesture: wave/point/none]
"""
```

–ü–∞—Ä—Å–∏—Ç–µ —Ç–µ–≥–∏ –≤ `stream_server.py`:
```python
import re

def parse_emotion_from_llm(text: str):
    emotion_match = re.search(r'\[emotion:\s*(\w+)\]', text)
    gesture_match = re.search(r'\[gesture:\s*(\w+)\]', text)
    
    emotion = emotion_match.group(1) if emotion_match else 'neutral'
    gesture = gesture_match.group(1) if gesture_match else None
    
    # –£–¥–∞–ª–∏—Ç–µ —Ç–µ–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    clean_text = re.sub(r'\[emotion:.*?\]', '', text)
    clean_text = re.sub(r'\[gesture:.*?\]', '', clean_text)
    
    return clean_text.strip(), emotion, gesture
```

---

## üì¶ –ì–æ—Ç–æ–≤—ã–µ VRM-–º–æ–¥–µ–ª–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ:
- [VRoid Hub](https://hub.vroid.com/) ‚Äî —Ñ–∏–ª—å—Ç—Ä "Asian" + "Female"
- [VRChat Models](https://vrchat.com/home/avatar) ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤ VRM

### –ü–ª–∞—Ç–Ω—ã–µ (–≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ):
- [Booth.pm](https://booth.pm/en/browse/3D%20Models) ‚Äî $10-50
- [Gumroad](https://gumroad.com/) ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏

### –°–æ–∑–¥–∞—Ç—å —Å –Ω—É–ª—è:
- [VRoid Studio](https://vroid.com/en/studio) (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!) ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—É—é –º–æ–¥–µ–ª—å –∑–∞ 30 –º–∏–Ω—É—Ç
- –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ `.vrm`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —Å–∏—Å—Ç–µ–º–µ

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Frontend (—á–∏—Å—Ç–æ JS, —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ):
- **three.js** ‚Äî 3D-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- **three-vrm** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ VRM-–º–æ–¥–µ–ª–µ–π
- **WebAudio Analyser** ‚Äî lip-sync —á–µ—Ä–µ–∑ —á–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- **Blendshapes** ‚Äî —ç–º–æ—Ü–∏–∏ (morph targets –Ω–∞ –º–æ–¥–µ–ª–∏)
- **AnimationMixer** ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∂–µ—Å—Ç–æ–≤/–∞–Ω–∏–º–∞—Ü–∏–π

### Backend (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É—á–∞—Å—Ç–∏–µ):
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `emotion` –∏ `gesture` –≤ JSON-—Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- Frontend —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (zero latency)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
‚úÖ **–ù—É–ª–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî backend –Ω–µ –Ω–∞–≥—Ä—É–∂–µ–Ω —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º  
‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π 3D, –∞ –Ω–µ –≤–∏–¥–µ–æ  
‚úÖ **–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è** ‚Äî –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å/–∞–Ω–∏–º–∞—Ü–∏–∏  

---

## üî• –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ VRM-–º–æ–¥–µ–ª—å** ‚Üí –ø–æ–ª–æ–∂–∏—Ç–µ –≤ `frontend/static/models/`
2. **–î–æ–±–∞–≤—å—Ç–µ –∞–Ω–∏–º–∞—Ü–∏–∏** ‚Üí —Å–∫–∞—á–∞–π—Ç–µ —Å Mixamo, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤ `avatar.js`
3. **–£–ª—É—á—à–∏—Ç–µ –¥–µ—Ç–µ–∫—Ü–∏—é —ç–º–æ—Ü–∏–π** ‚Üí –¥–æ–±–∞–≤—å—Ç–µ LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–≥–æ–≤
4. **–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π –∞–≤–∞—Ç–∞—Ä** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VRoid Studio (30 –º–∏–Ω)

---

## üí° –≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ, —á—Ç–æ –¥–µ–ª–∞—é—Ç —Ç–æ–ø–æ–≤—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏!

- **Soul Machines** ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (three.js + WebGL)
- **UneeQ** ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∞–≤–∞—Ç–∞—Ä–æ–≤
- **AWS Sumerian** (deprecated) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª three.js
- **Microsoft Azure Avatar** ‚Äî WebRTC + WebGL

**–í—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ production-grade —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é!** üöÄ
